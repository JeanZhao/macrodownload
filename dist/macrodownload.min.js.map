{"version":3,"sources":["webpack://core/webpack/universalModuleDefinition","webpack://core/webpack/bootstrap","webpack://core/external \"winston\"","webpack://core/./src/index.ts","webpack://core/./src/job/MacroDownload.ts","webpack://core/external \"puppeteer\"","webpack://core/./src/Services/utils.ts","webpack://core/external \"rxjs\"","webpack://core/./src/model/defaultConfig.ts"],"names":["root","factory","exports","module","define","amd","core","global","n","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","default","object","property","prototype","hasOwnProperty","p","s","e","require","a","this","__awaiter","u","Promise","next","throw","done","then","apply","__generator","label","sent","trys","ops","return","iterator","TypeError","pop","length","push","puppeteer","utils_1","rxjs_1","defaultConfig_1","winston","MacroDownload","utils","UtilService","runningList","runningSteam","Subject","getCustomizedOptions","options","result","assign","DefaultConfig","launchOptions","remainingConf","attr","closeBrowser","delay","indexPageDelay","_a","browser","close","launch","getRunningProcess","process","getCpuProcess","pid","resolve","initTaskList","tasks","_this","processId","forEach","task","index","findIndex","macroId","total","downloadLink","filter","success","errInfo","otherErr","download","openWebPage","page","info","mapSeries","_client","send","behavior","downloadPath","successIndex_1","total_1","menuList","menuSelector","clickBySelector","linkInfo","raceCheck","waitSelector","errorSelector","downloadContent","clickHandler","pushList","debug","param","JSON","stringify","clickDelay","errHandler","e_2","message","e_1","launchCallback","conf","isNeedLaunch","_b","newPage","goto","site","isNull","isUndefined","init","isEqualValue","item","curLink","err","errKey","type","includes","selector","waitForSelector","timeout","curMenu","e_3","race","checkSelector","reject","$selector","click","clickCount","isString","_instance","toString","p1","p2","k","time","setTimeout","array","promise","reduce","headless","defaultViewport","width","height","linkDelay"],"mappings":"CAAA,SAAAA,EAAAC,GACA,iBAAAC,SAAA,iBAAAC,OACAA,OAAAD,QAAAD,IACA,mBAAAG,eAAAC,IACAD,OAAA,UAAAH,GACA,iBAAAC,QACAA,QAAAI,KAAAL,IAEAD,EAAAM,KAAAL,IARA,CASCM,OAAA,WACD,gBAAAC,GCTA,IAAAC,EAAA,GAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAT,QAGA,IAAAC,EAAAM,EAAAE,GAAA,CACAC,EAAAD,EACAE,KACAX,QAAA,IAUA,OANAY,EAAAH,GAAAI,KAAAZ,EAAAD,QAAAC,IAAAD,QAAAQ,GAGAP,EAAAU,KAGAV,EAAAD,QA0DA,OArDAQ,EAAAM,EAAAF,EAGAJ,EAAAO,EAAAR,EAGAC,EAAAQ,EAAA,SAAAhB,EAAAiB,EAAAC,GACAV,EAAAW,EAAAnB,EAAAiB,IACAG,OAAAC,eAAArB,EAAAiB,EAAA,CAA0CK,cAAAC,IAAAL,KAK1CV,EAAAgB,EAAA,SAAAxB,GACA,oBAAAyB,eAAAC,aACAN,OAAAC,eAAArB,EAAAyB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAArB,EAAA,cAAiD2B,YAQjDnB,EAAAoB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAAnB,EAAAmB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFAxB,EAAAgB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,cAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAAnB,EAAAQ,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAvB,EAAAF,EAAA,SAAAL,GACA,IAAAiB,EAAAjB,KAAA6B,WACA,WAA2B,OAAA7B,EAAAkC,SAC3B,WAAiC,OAAAlC,GAEjC,OADAO,EAAAQ,EAAAE,EAAA,IAAAA,GACAA,GAIAV,EAAAW,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD7B,EAAAgC,EAAA,GAIAhC,IAAAiC,EAAA,GDxEA,CCwEA,UAAAC,EAAAd,GClFA3B,EAAAD,QAAA2C,QAAA,qBAAAD,EAAApC,EAAAsB,GAAA,aAAAR,OAAAC,eAAAf,EAAA,cAAAqB,OAAA,aAAAe,GAAA,QAAAd,KAAAc,EAAApC,EAAAiC,eAAAX,KAAAtB,EAAAsB,GAAAc,EAAAd,IAAA,CCGApB,EAAA,cAAAkC,EAAAd,EAAAtB,GAAA,iBAAAsC,EAAAC,WAAAC,WAAA,SAAA3B,EAAAsB,EAAAM,EAAAhC,GAAA,WAAAgC,MAAAC,UAAA,SAAAN,EAAAd,GAAA,SAAAtB,EAAAoC,GAAA,IAAAhC,EAAAK,EAAAkC,KAAAP,IAAA,MAAAA,GAAAd,EAAAc,IAAA,SAAAlB,EAAAkB,GAAA,IAAAhC,EAAAK,EAAAmC,MAAAR,IAAA,MAAAA,GAAAd,EAAAc,IAAA,SAAAhC,EAAAkB,KAAAuB,KAAAT,EAAAd,EAAAD,OAAA,IAAAoB,EAAA,SAAAL,KAAAd,EAAAD,SAAAyB,KAAA9C,EAAAkB,GAAAd,GAAAK,IAAAsC,MAAAlC,EAAAsB,GAAA,KAAAQ,WAAAtC,EAAAkC,WAAAS,aAAA,SAAAhD,EAAAkB,GAAA,IAAAd,EAAAS,EAAAsB,EAAAC,EAAAK,EAAA,CAAAQ,MAAA,EAAAC,KAAA,gBAAAf,EAAA,SAAAA,EAAA,UAAAA,EAAA,IAAAgB,KAAA,GAAAC,IAAA,WAAAhB,EAAA,CAAAO,KAAArB,EAAA,GAAAsB,MAAAtB,EAAA,GAAA+B,OAAA/B,EAAA,uBAAAH,SAAAiB,EAAAjB,OAAAmC,UAAA,kBAAAf,OAAAH,EAAA,SAAAd,KAAA,gBAAAc,GAAA,gBAAAd,GAAA,GAAAlB,EAAA,UAAAmD,UAAA,wCAAAd,GAAA,OAAArC,EAAA,EAAAS,IAAAsB,EAAA,EAAAb,EAAA,GAAAT,EAAAwC,OAAA/B,EAAA,GAAAT,EAAA+B,SAAAT,EAAAtB,EAAAwC,SAAAlB,EAAA5B,KAAAM,GAAA,GAAAA,EAAA8B,SAAAR,IAAA5B,KAAAM,EAAAS,EAAA,KAAAuB,KAAA,OAAAV,EAAA,OAAAtB,EAAA,EAAAsB,IAAAb,EAAA,GAAAA,EAAA,GAAAa,EAAAd,QAAAC,EAAA,kBAAAa,EAAAb,EAAA,oBAAAmB,EAAAQ,QAAA,CAAA5B,MAAAC,EAAA,GAAAuB,MAAA,UAAAJ,EAAAQ,QAAApC,EAAAS,EAAA,GAAAA,EAAA,oBAAAA,EAAAmB,EAAAW,IAAAI,MAAAf,EAAAU,KAAAK,MAAA,sBAAArB,EAAA,GAAAA,EAAAM,EAAAU,MAAAM,QAAAtB,IAAAsB,OAAA,UAAAnC,EAAA,QAAAA,EAAA,KAAAmB,EAAA,kBAAAnB,EAAA,MAAAa,GAAAb,EAAA,GAAAa,EAAA,IAAAb,EAAA,GAAAa,EAAA,KAAAM,EAAAQ,MAAA3B,EAAA,gBAAAA,EAAA,IAAAmB,EAAAQ,MAAAd,EAAA,IAAAM,EAAAQ,MAAAd,EAAA,GAAAA,EAAAb,EAAA,SAAAa,GAAAM,EAAAQ,MAAAd,EAAA,IAAAM,EAAAQ,MAAAd,EAAA,GAAAM,EAAAW,IAAAM,KAAApC,GAAA,MAAAa,EAAA,IAAAM,EAAAW,IAAAI,MAAAf,EAAAU,KAAAK,MAAA,SAAAlC,EAAAJ,EAAAX,KAAAP,EAAAyC,GAAA,MAAAL,GAAAd,EAAA,GAAAc,GAAAvB,EAAA,UAAAT,EAAA+B,EAAA,OAAAb,EAAA,SAAAA,EAAA,UAAAD,MAAAC,EAAA,GAAAA,EAAA,UAAAuB,MAAA,KAAAvB,EAAAc,OAAAtB,OAAAC,eAAAO,EAAA,cAAAD,OAAA,ICAA,IAAAsC,EAAAzD,EAAA,GACA0D,EAAA1D,EAAA,GACA2D,EAAA3D,EAAA,GAEA4D,EAAA5D,EAAA,GAGA6D,EAAA7D,EAAA,GAGA8D,EAAA,WAQI,SAAAA,IAPQzB,KAAA0B,MAAQ,IAAIL,EAAAM,YAGZ3B,KAAA4B,YAA4B,GAE7B5B,KAAA6B,aAA6B,IAAIP,EAAAQ,QA2L5C,OAtLWL,EAAAM,qBAAP,SAA4BC,GACxB,IAAIC,EAAc1D,OAAO2D,OAAO,GAAIX,EAAAY,eAChCH,EAAQI,eACR7D,OAAO2D,OAAOD,EAAOG,cAAeJ,EAAQI,eAEhD,IAAIC,EAAgB9D,OAAO2D,OAAO,GAAIF,GACtC,IAAK,IAAIM,KAAQD,EACA,kBAATC,UAAiCD,EAAcC,GAGvD,OADA/D,OAAO2D,OAAOD,EAAQI,GACfJ,GAGER,EAAAhC,UAAA8C,aAAb,kBAAAxC,EAAAC,UAAA,2BAAAlC,EAAAkC,KAAA,SAAAH,GAAA,OAAAA,EAAAa,OAAA,OACI,SAAMV,KAAK0B,MAAMc,MAAMjB,EAAAY,cAAcM,wBACrC,OADAC,EAAA/B,OACA,GAAMX,KAAK2C,QAAQC,gBAInB,OAJAF,EAAA/B,OACAX,KAAK2C,QAAU,KACf3C,KAAK6C,OAAS,KACd7C,KAAK6B,aAAe,KACpB,UAGGJ,EAAAhC,UAAAqD,kBAAP,WACI,OAAO9C,KAAK2C,QAAU3C,KAAK2C,QAAQI,UAAY,IAG5CtB,EAAAhC,UAAAuD,cAAP,SAAqBC,GAQjB,OAAO9C,QAAQ+C,WAGZzB,EAAAhC,UAAA0D,aAAP,SAAoBC,GAApB,IAAAC,EAAArD,KACUsD,EAAYtD,KAAK8C,oBAAoBG,IAC3CG,EAAMG,QAAQ,SAAAC,GACV,IAAMC,EAAQJ,EAAKzB,YAAY8B,UAAU,SAAA3E,GAAK,OAAAA,EAAEX,OAASoF,EAAKpF,MAAQW,EAAE4E,UAAYH,EAAKG,WAC1E,IAAXF,EACAJ,EAAKzB,YAAY6B,GAAOG,OAASP,EAAKzB,YAAY6B,GAAOG,MAAQJ,EAAKK,aAAaC,OAAO,SAAAjG,GAAK,QAAEA,EAAEgG,eAAc3C,OAEjHmC,EAAKzB,YAAYT,KAAK,CAClB/C,KAAQoF,EAAKpF,KACb6E,IAAOK,EACPK,QAAWH,EAAKG,QAChBC,MAASJ,EAAKK,aAAaC,OAAO,SAAAjG,GAAK,QAAEA,EAAEgG,eAAc3C,OACzD6C,QAAW,EACXC,QAAW,GACXC,SAAY,OAIxBjE,KAAK6B,aAAazB,KAAKJ,KAAK4B,cAInBH,EAAAhC,UAAAyE,SAAb,SAAsBd,EAAepB,wGACtB,SAAMhC,KAAKmE,YAAYnC,EAC9B,WAAM,OAAAqB,EAAKF,aAAaC,aAG5B,OAJIgB,EAAO1B,EAAA/B,OAGXa,EAAQ6C,KAAK,sCAAsCjB,EAAMlC,QACzD,GAAMlB,KAAK0B,MAAM4C,UAAUlB,EAAO,SAAMI,GAAI,OAAAvD,EAAAoD,cAAA,iBAAA/E,EAAAsB,EAAAb,EAAAtB,EAAAuC,KAAA,OAAAlC,EAAAkC,KAAA,SAAAH,GAAA,OAAAA,EAAAa,OAAA,OAEpC,OAAAb,EAAAe,KAAAO,KAAA,aAAOiD,EAAaG,QAAQC,KAAK,2BAA4B,CACzDC,SAAU,QACVC,aAAclB,EAAKkB,uBAOvB,OATAhC,EAAA/B,OAKIgE,EAAe,EACbC,EAAQpB,EAAKK,aAAaC,OAAO,SAAAjG,GAAK,QAAEA,EAAEgG,eAAc3C,OAG9D,GAAMlB,KAAK0B,MAAM4C,UAAUd,EAAKqB,SAAU,SAAOC,EAAcrB,GAAK,OAAAxD,EAAAoD,cAAA,oBAAAvF,EAAAkC,KAAA,SAAAH,GAAA,OAAAA,EAAAa,OAAA,OAEhE,OADAc,EAAQ6C,KAAK,4BAA4BS,GACzC,GAAM9E,KAAK+E,gBAAgBD,EAActB,EAAMY,kBAA/C1B,EAAA/B,0BAIJ,OANA+B,EAAA/B,OAMA,GAAMX,KAAK0B,MAAM4C,UAAUd,EAAKK,aAAc,SAAMmB,GAAQ,OAAA/E,EAAAoD,cAAA,iBAAAtE,EAAAtB,EAAAkB,EAAA,OAAAb,EAAAkC,KAAA,SAAAH,GAAA,OAAAA,EAAAa,OAAA,OACxDc,EAAQ6C,KAAK,gCAAgCW,EAAS5G,uBAElD,OAAAyB,EAAAe,KAAAO,KAAA,aAAMnB,KAAKiF,UAAUD,EAASE,aAAcF,EAASG,cAAef,WAC9C,OADtB1B,EAAA/B,OACsB,GAAMX,KAAKiF,UAAUD,EAASnB,aAAcmB,EAASG,cAAef,WAC1F,OADIgB,EAAkB1C,EAAA/B,OACtB,GAAMX,KAAKqF,aAAaD,WAIxB,OAJA1C,EAAA/B,OACAgE,IACA3E,KAAKsF,SAAS,CAAC9B,KAAMA,EAAMO,QAAS,IACpCvC,EAAQ+D,MAAM,YAAYZ,EAAY,IAAIC,EAAK,oBAAoBpB,EAAKpF,MAAOoF,EAAKgC,MAAQ,eAAiBC,KAAKC,UAAUlC,EAAKgC,OAAS,KAC1I,GAAMxF,KAAK0B,MAAMc,MAAMjB,EAAAY,cAAcwD,2BAArCjD,EAAA/B,sCAEM0D,EAAO,0BAA0BW,EAAS5G,KAAI,aAAaoF,EAAKpF,KAAI,KAAIoF,EAAKgC,MAAQ,eAAiBC,KAAKC,UAAUlC,EAAKgC,OAAS,IACzIxF,KAAK4F,WAAWpC,EAAMqC,EAAEC,QAAUD,EAAIxB,gDAZ9C3B,EAAA/B,sCAgBAX,KAAK4F,WAAWpC,EAAMuC,yCAG9B,OApCArD,EAAA/B,OAoCA,UAGUc,EAAAhC,UAAA0E,YAAd,SAA0BnC,EAAkBgE,4GACpCC,EAAOxE,EAAcM,qBAAqBC,GAC1ChC,KAAKkG,aAAaD,IAClBjG,KAAK6C,OAASoD,EAAK7D,cACnBM,EAAA1C,KAAe,GAAMoB,EAAUyB,OAAO7C,KAAK6C,UAF3C,aAEAH,EAAKC,QAAUwD,EAAAxF,OACXqF,GACAA,qBAGG,SAAMhG,KAAK2C,QAAQyD,kBAC9B,UADIhC,EAAO+B,EAAAxF,QACA0F,KAAK,GAAGJ,EAAKK,cACxB,OADAH,EAAAxF,OACA,GAAMX,KAAK0B,MAAMc,MAAMyD,EAAKxD,wBAC5B,OADA0D,EAAAxF,OACA,GAAOyD,SAGH3C,EAAAhC,UAAAyG,aAAR,SAAqBlE,GACjB,OAAOX,EAAAM,YAAY4E,OAAOvG,KAAK2C,UAAYtB,EAAAM,YAAY6E,YAAYxG,KAAK2C,UAChEX,EAAQyE,MAAQzG,KAAK6C,SACjBxB,EAAAM,YAAY+E,aAAa1G,KAAK6C,OAAQb,EAAQI,gBAGtDX,EAAAhC,UAAA6F,SAAR,SAAiBqB,GACb,IAAMlD,EAAQzD,KAAK4B,YAAY8B,UAAU,SAAA3E,GAAK,OAAAA,EAAEX,OAASuI,EAAKnD,KAAKpF,MAAQW,EAAE4E,UAAYgD,EAAKnD,KAAKG,UACnG,IAAe,IAAXF,EAAc,CACd,IAAImD,EAAU5G,KAAK4B,YAAY6B,GAK/B,GAJIkD,EAAK5C,UACL6C,EAAiB7C,SAAK6C,EAAiB7C,QAAI4C,EAAK5C,SAGhD4C,EAAKE,IAAK,CACV,IAAMC,EAA2B,aAAlBH,EAAKE,IAAIE,KAAsB,MAAQ,WACtDJ,EAAKE,IAAIxC,KAAO,IAAIuC,EAAQjD,QAAO,MAAMgD,EAAKE,IAAIxC,KAC7CyC,EAAOE,SAASL,EAAKE,IAAIxC,OAC1BuC,EAAQE,GAAQ3F,KAAKwF,EAAKE,IAAIxC,MAItCrE,KAAK6B,aAAazB,KAAKJ,KAAK4B,eAItBH,EAAAhC,UAAAsF,gBAAd,SAA8BkC,EAAkBzD,EAAYY,mGAEtC,OAAAvE,EAAAe,KAAAO,KAAA,aAAMiD,EAAK8C,gBAAgBD,EAAU,CAACE,QAASnH,KAAK6C,OAAOsE,kBACzE,OADIC,EAAU1E,EAAA/B,OACd,GAAMX,KAAKqF,aAAa+B,WACxB,OADA1E,EAAA/B,OACA,kBAAAlD,EAAAoC,EAAAc,OAEAX,KAAK4F,WAAWpC,EAAM6D,gCAItB5F,EAAAhC,UAAAwF,UAAR,SAAkBgC,EAAkB9B,EAAuBf,GACvD,OAAOjE,QAAQmH,KAAK,CAACtH,KAAKuH,cAAcN,EAAU7C,GAAOpE,KAAKuH,cAAcpC,EAAef,MAGvF3C,EAAAhC,UAAA8H,cAAR,SAAsBN,EAAkB7C,GACpC,OAAOA,EAAK8C,gBAAgBD,EAAU,CAACE,QAASnH,KAAK6C,OAAOsE,UACvD5G,KAAK,SAAAzB,GACF,OAAOmI,EAASD,SAAS,8BAAkC7G,QAAQqH,SAAWrH,QAAQ+C,QAAQpE,MAI5F2C,EAAAhC,UAAA4F,aAAd,SAA2BoC,2FACvB,SAAMA,EAAUC,MAAM,CAACC,WAAY,EAAGnF,MAAOjB,EAAAY,cAAcwD,qBAC3D,OADAjD,EAAA/B,OACA,GAAMX,KAAK0B,MAAMc,MAAMjB,EAAAY,cAAcwD,oBACrC,OADAjD,EAAA/B,OACA,UAGIc,EAAAhC,UAAAmG,WAAR,SAAmBpC,EAAY3D,GAC3B,IAAIgH,EAEAA,EADAxF,EAAAM,YAAYiG,SAAS/H,GACf,CAACkH,KAAQ,WAAY1C,KAAQxE,GAE7B,CAACkH,KAAQ,QAAS1C,KAAQxE,EAAEiG,SAAWL,KAAKC,UAAU7F,IAEhEG,KAAKsF,SAAS,CAAC9B,KAAMA,EAAMqD,IAAKA,KAIxCpF,EAjMA,GAAatE,EAAAsE,+BCbbrE,EAAAD,QAAA2C,QAAA,uBAAAD,EAAAd,EAAAtB,GAAA,aAAAc,OAAAC,eAAAO,EAAA,cAAAD,OAAA,ICIA,IAAA0C,EAAA7D,EAAA,GAEAgE,EAAA,WAEI,SAAAA,IACIA,EAAYkG,UAAY7H,KAqChC,OAnCW2B,EAAA4E,OAAP,SAAc1I,GACV,MAA6C,kBAAtCU,OAAOkB,UAAUqI,SAAS9J,KAAKH,IAGnC8D,EAAA6E,YAAP,SAAmB3I,GACf,MAA6C,uBAAtCU,OAAOkB,UAAUqI,SAAS9J,KAAKH,IAGnC8D,EAAAiG,SAAP,SAAgB/J,GACZ,MAA6C,oBAAtCU,OAAOkB,UAAUqI,SAAS9J,KAAKH,IAGnC8D,EAAA+E,aAAP,SAAoBqB,EAAmBC,GACnC,IAAI/F,EACJ,IAAK,IAAIgG,KAAKF,EACV9F,EAAS8F,EAAGE,KAAOD,EAAGC,GAE1B,OAAOhG,GAGXN,EAAAlC,UAAA+C,MAAA,SAAM0F,GACF,OAAO,IAAI/H,QAAQ,SAAA+C,GACfiF,WAAW,WAAM,OAAAjF,EAAQ,KAAKgF,MAItCvG,EAAAlC,UAAA6E,UAAA,SAAU8D,EAAcC,GACpB,OAAmB,EAAfD,EAAMlH,OACCkH,EAAME,OAAO,SAAC3I,EAAGzB,EAAGL,GAAM,OAAA8B,EAAEY,KAAK,WAAM,OAAA8H,EAAQnK,EAAGL,MAAKsC,QAAQ+C,YAEtE1B,EAAQ6C,KAAK,oCACNlE,QAAQ+C,YAnCRvB,EAAAkG,UAAyB,IAAIlG,EAuChDA,EAxCA,GAAaxE,EAAAwE,6BCNbvE,EAAAD,QAAA2C,QAAA,kBAAAD,EAAAd,EAAAtB,GAAA,aAAAc,OAAAC,eAAAO,EAAA,cAAAD,OAAA,ICIa3B,EAAAgF,cAAgB,CAGzBC,cAAe,CACXmG,YACAC,gBAAiB,CACbC,MAAO,KACPC,OAAQ,KAEZvB,QAAS,MAKb1E,eAAgB,IAChBkG,UAAW,IACXhD,WAAY,IAGZc","file":"macrodownload.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"core\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"core\"] = factory();\n\telse\n\t\troot[\"core\"] = factory();\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = require(\"winston\");","/**\n * Created by jeanzhao on 10/23/18.\n */\nexport * from \"./job/MacroDownload\";","/**\n * Created by jeanzhao on 12/23/18.\n */\nimport * as puppeteer from \"puppeteer\";\nimport {UtilService} from \"../Services/utils\";\nimport {Subject} from \"rxjs\";\nimport {Options, LaunchOptions} from \"../model/Options\";\nimport {DefaultConfig} from \"../model/defaultConfig\";\nimport {Task} from \"../model/Task\";\nimport {ERROR, TaskStatus} from \"../model/TaskStatus\";\nimport * as winston from \"winston\";\n// import pidusage, { Stat } from 'pidusage';\n\nexport class MacroDownload {\n    private utils = new UtilService();\n    private browser: any;\n    private launch: LaunchOptions;\n    private runningList: TaskStatus[] = [];\n\n    public runningSteam: Subject<any> = new Subject<any>();\n\n    constructor() {\n    }\n\n    static getCustomizedOptions(options?: Options): Options {\n        let result: any = Object.assign({}, DefaultConfig);\n        if (options.launchOptions) {\n            Object.assign(result.launchOptions, options.launchOptions);\n        }\n        let remainingConf = Object.assign({}, options);\n        for (let attr in remainingConf) {\n            if (attr === 'launchOptions') delete remainingConf[attr];\n        }\n        Object.assign(result, remainingConf);\n        return result;\n    }\n\n    public async closeBrowser() {\n        await this.utils.delay(DefaultConfig.indexPageDelay);\n        await this.browser.close();\n        this.browser = null;\n        this.launch = null;\n        this.runningSteam = null;\n        return;\n    }\n\n    public getRunningProcess() {\n        return this.browser ? this.browser.process() : {};\n    }\n\n    public getCpuProcess(pid: number): Promise<any> {\n        // TODO enhance with pidusage\n        // return new Promise((resolve, reject) => {\n        //     pidusage(pid, (err, stas) => {\n        //         if (err) reject(err);\n        //         resolve(stas);\n        //     })\n        // });\n        return Promise.resolve();\n    }\n\n    public initTaskList(tasks: Task[]) {\n        const processId = this.getRunningProcess().pid;\n        tasks.forEach(task => {\n            const index = this.runningList.findIndex(t => t.name === task.name && t.macroId === task.macroId);\n            if (index !== -1) {\n                this.runningList[index].total = +this.runningList[index].total + task.downloadLink.filter(i => !!i.downloadLink).length;\n            } else {\n                this.runningList.push({\n                    \"name\": task.name,\n                    \"pid\": processId,\n                    \"macroId\": task.macroId,\n                    \"total\": task.downloadLink.filter(i => !!i.downloadLink).length,\n                    \"success\": 0,\n                    \"errInfo\": [],\n                    \"otherErr\": []\n                });\n            }\n        });\n        this.runningSteam.next(this.runningList);\n        return;\n    }\n\n    public async download(tasks: Task[], options: Options) {\n        let page = await this.openWebPage(options,\n            () => this.initTaskList(tasks)\n        );\n        winston.info(`start macro download, task numbers:${tasks.length}`);\n        await this.utils.mapSeries(tasks, async task => {\n            try {\n                await (page as any)._client.send('Page.setDownloadBehavior', {\n                    behavior: 'allow',\n                    downloadPath: task.downloadPath\n                });\n\n                let successIndex = 0;\n                const total = task.downloadLink.filter(i => !!i.downloadLink).length;\n\n                // 1. click nested menu\n                await this.utils.mapSeries(task.menuList, async (menuSelector, index) => {\n                    winston.info(`click menu with selector:${menuSelector}`);\n                    await this.clickBySelector(menuSelector, task, page);\n                });\n\n                // 2. download files after the last menu link\n                await this.utils.mapSeries(task.downloadLink, async linkInfo => {\n                    winston.info(`start to download a file for ${linkInfo.name}`);\n                    try {\n                        await this.raceCheck(linkInfo.waitSelector, linkInfo.errorSelector, page);\n                        let downloadContent = await this.raceCheck(linkInfo.downloadLink, linkInfo.errorSelector, page);\n                        await this.clickHandler(downloadContent);\n                        successIndex++;\n                        this.pushList({task: task, success: 1});\n                        winston.debug(`Complete ${successIndex}/${total} for downloading ${task.name}${task.param ? ' with param ' + JSON.stringify(task.param) : ''}`);\n                        await this.utils.delay(DefaultConfig.clickDelay);\n                    } catch (e) {\n                        const info = `fail download file for ${linkInfo.name} of link '${task.name}'${task.param ? ' with param ' + JSON.stringify(task.param) : ''}`;\n                        this.errHandler(task, e.message ? e : info);\n                    }\n                });\n            } catch (e) {\n                this.errHandler(task, e);\n            }\n        });\n        return;\n    }\n\n    private async openWebPage(options: Options, launchCallback?: () => void) {\n        let conf = MacroDownload.getCustomizedOptions(options);\n        if (this.isNeedLaunch(conf)) {\n            this.launch = conf.launchOptions;\n            this.browser = await puppeteer.launch(this.launch);\n            if (launchCallback) {\n                launchCallback();\n            }\n        }\n        let page = await this.browser.newPage();\n        await page.goto(`${conf.site}`);\n        await this.utils.delay(conf.indexPageDelay);\n        return page;\n    }\n\n    private isNeedLaunch(options: Options): boolean {\n        return UtilService.isNull(this.browser) || UtilService.isUndefined(this.browser)\n            || (options.init && this.launch\n                && !UtilService.isEqualValue(this.launch, options.launchOptions));\n    }\n\n    private pushList(item: { task: Task, success?: number, err?: ERROR }): void {\n        const index = this.runningList.findIndex(t => t.name === item.task.name && t.macroId === item.task.macroId);\n        if (index !== -1) {\n            let curLink = this.runningList[index];\n            if (item.success) {\n                curLink[\"success\"] = +curLink[\"success\"] + item.success;\n            }\n\n            if (item.err) {\n                const errKey = item.err.type === \"download\" ? \"err\" : \"otherErr\";\n                item.err.info = `[${curLink.macroId}]: ${item.err.info}`;\n                if (!errKey.includes(item.err.info)) {\n                    curLink[errKey].push(item.err.info);\n                }\n            }\n\n            this.runningSteam.next(this.runningList);\n        }\n    }\n\n    private async clickBySelector(selector: string, task: Task, page: any) {\n        try {\n            let curMenu = await page.waitForSelector(selector, {timeout: this.launch.timeout});\n            await this.clickHandler(curMenu);\n            return;\n        } catch (e) {\n            this.errHandler(task, e);\n        }\n    }\n\n    private raceCheck(selector: string, errorSelector: string, page: any): Promise<any> {\n        return Promise.race([this.checkSelector(selector, page), this.checkSelector(errorSelector, page)]);\n    }\n\n    private checkSelector(selector: string, page: any): Promise<any> {\n        return page.waitForSelector(selector, {timeout: this.launch.timeout})\n            .then(value => {\n                return selector.includes('img[src$=\\'/error_500.png\\']') ? Promise.reject() : Promise.resolve(value);\n            });\n    }\n\n    private async clickHandler($selector: any) {\n        await $selector.click({clickCount: 1, delay: DefaultConfig.clickDelay});\n        await this.utils.delay(DefaultConfig.clickDelay);\n        return;\n    }\n\n    private errHandler(task: Task, e: any) {\n        let err;\n        if (UtilService.isString(e)) {\n            err = {\"type\": \"download\", \"info\": e};\n        } else {\n            err = {\"type\": \"other\", \"info\": e.message || JSON.stringify(e)};\n        }\n        this.pushList({task: task, err: err});\n        return;\n    }\n\n}","module.exports = require(\"puppeteer\");","/**\n * Created by jeanzhao on 11/23/18.\n */\nimport {LaunchOptions} from \"../model/Options\";\nimport * as winston from \"winston\";\n\nexport class UtilService {\n    private static _instance: UtilService = new UtilService();\n    constructor(){\n        UtilService._instance = this;\n    }\n    static isNull(i: any): boolean {\n        return Object.prototype.toString.call(i) === \"[object Null]\";\n    }\n\n    static isUndefined(i: any): boolean {\n        return Object.prototype.toString.call(i) === \"[object Undefined]\";\n    }\n\n    static isString(i: any): boolean {\n        return Object.prototype.toString.call(i) === \"[object String]\";\n    }\n\n    static isEqualValue(p1: LaunchOptions, p2: LaunchOptions): boolean {\n        let result;\n        for (let k in p1) {\n            result = p1[k] !== p2[k];\n        }\n        return result;\n    }\n\n    delay(time: number): Promise<string> {\n        return new Promise(resolve => {\n            setTimeout(() => resolve(\"\"), time);\n        });\n    }\n\n    mapSeries(array: any[], promise: (value, index) => Promise<any>): Promise<any> {\n        if (array.length > 0) {\n            return array.reduce((p, c, i) => p.then(() => promise(c, i)), Promise.resolve());\n        } else {\n            winston.info(`found empty list need execution.`);\n            return Promise.resolve();\n        }\n    }\n\n}","module.exports = require(\"rxjs\");","/**\n * Created by jeanzhao on 10/23/18.\n */\n\nexport const DefaultConfig = {\n\n    // puppeteer launch setting\n    launchOptions: {\n        headless: false,\n        defaultViewport: {\n            width: 1024,\n            height: 768\n        },\n        timeout: 60 * 60 * 1000\n    },\n\n\n    // delay for visiting a link\n    indexPageDelay: 5000,\n    linkDelay: 2000,\n    clickDelay: 1000,\n\n    // force to initialize opening chrome\n    init: true\n};\n"],"sourceRoot":""}