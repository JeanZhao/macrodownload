{"version":3,"sources":["webpack://core/webpack/universalModuleDefinition","webpack://core/webpack/bootstrap","webpack://core/external \"winston\"","webpack://core/./src/index.ts","webpack://core/./src/job/MacroDownload.ts","webpack://core/external \"puppeteer\"","webpack://core/./src/Services/utils.ts","webpack://core/external \"rxjs\"","webpack://core/./src/model/defaultConfig.ts","webpack://core/external \"pidusage\""],"names":["root","factory","exports","module","define","amd","core","global","n","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","default","object","property","prototype","hasOwnProperty","p","s","e","require","a","this","__awaiter","u","Promise","next","throw","done","then","apply","__generator","label","sent","trys","ops","return","iterator","TypeError","pop","length","push","puppeteer","utils_1","rxjs_1","defaultConfig_1","winston","pidUsage","MacroDownload","utils","UtilService","runningList","runningSteam","Subject","getCustomizedOptions","options","result","assign","DefaultConfig","launchOptions","remainingConf","attr","closeBrowser","delay","indexPageDelay","_a","browser","close","clear","launch","getCpuProcess","processId","pid","getRunningProcess","cpu","stat","debug","toFixed","process","initTaskList","tasks","processInfo","forEach","task","index","_this","findIndex","macroId","total","downloadLink","filter","success","errInfo","otherErr","download","openWebPage","page","info","mapSeries","_client","send","behavior","downloadPath","successIndex_1","total_1","menuList","menuSelector","clickBySelector","linkInfo","raceCheck","waitSelector","errorSelector","downloadContent","clickHandler","pushList","param","JSON","stringify","clickDelay","errHandler","e_2","message","e_1","launchCallback","conf","isNeedLaunch","_b","newPage","goto","site","isNull","isUndefined","init","isEqualValue","item","curLink","err","errKey","type","includes","selector","waitForSelector","timeout","curMenu","e_3","race","checkSelector","reject","resolve","$selector","click","clickCount","isString","_instance","toString","p1","p2","k","time","setTimeout","array","promise","reduce","headless","defaultViewport","width","height","linkDelay"],"mappings":"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","file":"macrodownload.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"core\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"core\"] = factory();\n\telse\n\t\troot[\"core\"] = factory();\n})(global, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = require(\"winston\");","/**\n * Created by jeanzhao on 10/23/18.\n */\nexport * from \"./job/MacroDownload\";","/**\n * Created by jeanzhao on 12/23/18.\n */\nimport * as puppeteer from \"puppeteer\";\nimport {UtilService} from \"../Services/utils\";\nimport {Subject} from \"rxjs\";\nimport {Options, LaunchOptions} from \"../model/Options\";\nimport {DefaultConfig} from \"../model/defaultConfig\";\nimport {Task} from \"../model/Task\";\nimport {ERROR, ProcessInfo, TaskStatus} from \"../model/TaskStatus\";\nimport * as winston from \"winston\";\nimport * as pidUsage from 'pidusage';\n\nexport class MacroDownload {\n    private utils = new UtilService();\n    private browser: any;\n    private launch: LaunchOptions;\n    private runningList: TaskStatus[] = [];\n\n    public runningSteam: Subject<TaskStatus[]> = new Subject<TaskStatus[]>();\n\n    constructor() {\n    }\n\n    static getCustomizedOptions(options?: Options): Options {\n        let result: any = Object.assign({}, DefaultConfig);\n        if (options.launchOptions) {\n            Object.assign(result.launchOptions, options.launchOptions);\n        }\n        let remainingConf = Object.assign({}, options);\n        for (let attr in remainingConf) {\n            if (attr === 'launchOptions') delete remainingConf[attr];\n        }\n        Object.assign(result, remainingConf);\n        return result;\n    }\n\n    public async closeBrowser() {\n        await this.utils.delay(DefaultConfig.indexPageDelay);\n        await this.browser.close();\n        await pidUsage.clear();\n        this.browser = null;\n        this.launch = null;\n        this.runningSteam = null;\n        return;\n    }\n\n    public async getCpuProcess(processId?: number): Promise<ProcessInfo> {\n        let pid = processId || this.getRunningProcess().pid;\n        let cpu = 0;\n        if (pid) {\n            let stat = await pidUsage(pid);\n            winston.debug('--------pid----cpu: ' + cpu);\n            cpu = stat.cpu ? +(stat.cpu).toFixed(2) : 0;\n        }\n        winston.debug('------------cpu: ' + cpu);\n        return {pid, cpu};\n    }\n\n    public getRunningProcess() {\n        return this.browser ? this.browser.process() : {};\n    }\n\n    public async initTaskList(tasks: Task[]) {\n        const processInfo = await this.getCpuProcess();\n        tasks.forEach(task => {\n            const index = this.runningList.findIndex(t => t.name === task.name && t.macroId === task.macroId);\n            if (index !== -1) {\n                this.runningList[index].total = +this.runningList[index].total + task.downloadLink.filter(i => !!i.downloadLink).length;\n            } else {\n                this.runningList.push({\n                    \"name\": task.name,\n                    \"processInfo\": processInfo,\n                    \"macroId\": task.macroId,\n                    \"total\": task.downloadLink.filter(i => !!i.downloadLink).length,\n                    \"success\": 0,\n                    \"errInfo\": [],\n                    \"otherErr\": []\n                });\n            }\n        });\n        this.runningSteam.next(this.runningList);\n        return;\n    }\n\n    public async download(tasks: Task[], options: Options) {\n        let page = await this.openWebPage(options,\n            () => this.initTaskList(tasks)\n        );\n        winston.info(`start macro download, task numbers:${tasks.length}`);\n        await this.utils.mapSeries(tasks, async task => {\n            try {\n                await (page as any)._client.send('Page.setDownloadBehavior', {\n                    behavior: 'allow',\n                    downloadPath: task.downloadPath\n                });\n\n                let successIndex = 0;\n                const total = task.downloadLink.filter(i => !!i.downloadLink).length;\n\n                // 1. click nested menu\n                await this.utils.mapSeries(task.menuList, async (menuSelector, index) => {\n                    winston.info(`click menu with selector:${menuSelector}`);\n                    await this.clickBySelector(menuSelector, task, page);\n                });\n\n                // 2. download files after the last menu link\n                await this.utils.mapSeries(task.downloadLink, async linkInfo => {\n                    winston.info(`start to download a file for ${linkInfo.name}`);\n                    try {\n                        await this.raceCheck(linkInfo.waitSelector, linkInfo.errorSelector, page);\n                        let downloadContent = await this.raceCheck(linkInfo.downloadLink, linkInfo.errorSelector, page);\n                        await this.clickHandler(downloadContent);\n                        successIndex++;\n                        this.pushList({task: task, success: 1});\n                        winston.debug(`Complete ${successIndex}/${total} for downloading ${task.name}${task.param ? ' with param ' + JSON.stringify(task.param) : ''}`);\n                        await this.utils.delay(DefaultConfig.clickDelay);\n                    } catch (e) {\n                        const info = `fail download file for ${linkInfo.name} of link '${task.name}'${task.param ? ' with param ' + JSON.stringify(task.param) : ''}`;\n                        this.errHandler(task, e.message ? e : info);\n                    }\n                });\n            } catch (e) {\n                this.errHandler(task, e);\n            }\n        });\n        return;\n    }\n\n    private async openWebPage(options: Options, launchCallback?: () => void) {\n        let conf = MacroDownload.getCustomizedOptions(options);\n        if (this.isNeedLaunch(conf)) {\n            this.launch = conf.launchOptions;\n            this.browser = await puppeteer.launch(this.launch);\n            if (launchCallback) {\n                launchCallback();\n            }\n        }\n        let page = await this.browser.newPage();\n        await page.goto(`${conf.site}`);\n        await this.utils.delay(conf.indexPageDelay);\n        return page;\n    }\n\n    private isNeedLaunch(options: Options): boolean {\n        return UtilService.isNull(this.browser) || UtilService.isUndefined(this.browser)\n            || (options.init && this.launch\n                && !UtilService.isEqualValue(this.launch, options.launchOptions));\n    }\n\n    private async pushList(item: { task: Task, success?: number, err?: ERROR }) {\n        const index = this.runningList.findIndex(t => t.name === item.task.name && t.macroId === item.task.macroId);\n        if (index !== -1) {\n            let curLink = this.runningList[index];\n            if (item.success) {\n                curLink[\"success\"] = +curLink[\"success\"] + item.success;\n            }\n\n            if (item.err) {\n                const errKey = item.err.type === \"download\" ? \"err\" : \"otherErr\";\n                item.err.info = `[${curLink.macroId}]: ${item.err.info}`;\n                if (!errKey.includes(item.err.info)) {\n                    curLink[errKey].push(item.err.info);\n                }\n            }\n\n            curLink.processInfo = await this.getCpuProcess(curLink.processInfo.pid);\n            this.runningSteam.next(this.runningList);\n        }\n    }\n\n    private async clickBySelector(selector: string, task: Task, page: any) {\n        try {\n            let curMenu = await page.waitForSelector(selector, {timeout: this.launch.timeout});\n            await this.clickHandler(curMenu);\n            return;\n        } catch (e) {\n            this.errHandler(task, e);\n        }\n    }\n\n    private raceCheck(selector: string, errorSelector: string, page: any): Promise<any> {\n        return Promise.race([this.checkSelector(selector, page), this.checkSelector(errorSelector, page)]);\n    }\n\n    private checkSelector(selector: string, page: any): Promise<any> {\n        return page.waitForSelector(selector, {timeout: this.launch.timeout})\n            .then(value => {\n                return selector.includes('img[src$=\\'/error_500.png\\']') ? Promise.reject() : Promise.resolve(value);\n            });\n    }\n\n    private async clickHandler($selector: any) {\n        await $selector.click({clickCount: 1, delay: DefaultConfig.clickDelay});\n        await this.utils.delay(DefaultConfig.clickDelay);\n        return;\n    }\n\n    private errHandler(task: Task, e: any) {\n        let err;\n        if (UtilService.isString(e)) {\n            err = {\"type\": \"download\", \"info\": e};\n        } else {\n            err = {\"type\": \"other\", \"info\": e.message || JSON.stringify(e)};\n        }\n        this.pushList({task: task, err: err});\n        return;\n    }\n\n}","module.exports = require(\"puppeteer\");","/**\n * Created by jeanzhao on 11/23/18.\n */\nimport {LaunchOptions} from \"../model/Options\";\nimport * as winston from \"winston\";\n\nexport class UtilService {\n    private static _instance: UtilService = new UtilService();\n    constructor(){\n        UtilService._instance = this;\n    }\n    static isNull(i: any): boolean {\n        return Object.prototype.toString.call(i) === \"[object Null]\";\n    }\n\n    static isUndefined(i: any): boolean {\n        return Object.prototype.toString.call(i) === \"[object Undefined]\";\n    }\n\n    static isString(i: any): boolean {\n        return Object.prototype.toString.call(i) === \"[object String]\";\n    }\n\n    static isEqualValue(p1: LaunchOptions, p2: LaunchOptions): boolean {\n        let result;\n        for (let k in p1) {\n            result = p1[k] !== p2[k];\n        }\n        return result;\n    }\n\n    delay(time: number): Promise<string> {\n        return new Promise(resolve => {\n            setTimeout(() => resolve(\"\"), time);\n        });\n    }\n\n    mapSeries(array: any[], promise: (value, index) => Promise<any>): Promise<any> {\n        if (array.length > 0) {\n            return array.reduce((p, c, i) => p.then(() => promise(c, i)), Promise.resolve());\n        } else {\n            winston.info(`found empty list need execution.`);\n            return Promise.resolve();\n        }\n    }\n\n}","module.exports = require(\"rxjs\");","/**\n * Created by jeanzhao on 10/23/18.\n */\n\nexport const DefaultConfig = {\n\n    // puppeteer launch setting\n    launchOptions: {\n        headless: false,\n        defaultViewport: {\n            width: 1024,\n            height: 768\n        },\n        timeout: 60 * 60 * 1000\n    },\n\n\n    // delay for visiting a link\n    indexPageDelay: 5000,\n    linkDelay: 2000,\n    clickDelay: 1000,\n\n    // force to initialize opening chrome\n    init: true\n};\n","module.exports = require(\"pidusage\");"],"sourceRoot":""}